openapi: 3.0.3
info:
  title: CMS Electronic PA Submission System API
  description: |
    API for automated Prior Authorization (PA) request submission in accordance with CMS regulations.
    
    ## Features
    - Electronic PA submission using HL7 FHIR R4 and X12 278 standards
    - Automated workflow processing
    - Real-time status tracking
    - CMS compliance validation
    - Comprehensive audit trails
    
  version: 1.0.0
  contact:
    name: API Support
    email: support@cms-pa-system.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://localhost:3000/api/v1
    description: Development server
  - url: https://api.cms-pa-system.com/api/v1
    description: Production server

tags:
  - name: Health
    description: Health check endpoints
  - name: PA Requests
    description: Prior Authorization request management
  - name: Workflows
    description: Workflow management and automation
  - name: Configuration
    description: System configuration (Admin only)

security:
  - bearerAuth: []

paths:
  /health:
    get:
      tags:
        - Health
      summary: Health check
      description: Check if the API is running
      operationId: getHealth
      security: []
      responses:
        '200':
          description: System is healthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'

  /health/ready:
    get:
      tags:
        - Health
      summary: Readiness check
      description: Check if the API is ready to accept requests
      operationId: getReadiness
      security: []
      responses:
        '200':
          description: System is ready
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'
        '503':
          description: System is not ready
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /pa-requests:
    post:
      tags:
        - PA Requests
      summary: Create a new PA request
      description: Create a new Prior Authorization request
      operationId: createPARequest
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreatePARequestInput'
      responses:
        '201':
          description: PA request created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PARequest'
        '400':
          description: Invalid request data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    get:
      tags:
        - PA Requests
      summary: Search PA requests
      description: Search and filter PA requests
      operationId: searchPARequests
      parameters:
        - name: status
          in: query
          description: Filter by status
          schema:
            type: array
            items:
              $ref: '#/components/schemas/PAStatus'
        - name: priority
          in: query
          description: Filter by priority
          schema:
            type: array
            items:
              $ref: '#/components/schemas/Priority'
        - name: patientId
          in: query
          description: Filter by patient ID
          schema:
            type: string
        - name: providerId
          in: query
          description: Filter by provider NPI
          schema:
            type: string
        - name: trackingId
          in: query
          description: Filter by tracking ID
          schema:
            type: string
        - name: limit
          in: query
          description: Maximum number of results
          schema:
            type: integer
            default: 50
            minimum: 1
            maximum: 100
        - name: offset
          in: query
          description: Number of results to skip
          schema:
            type: integer
            default: 0
            minimum: 0
      responses:
        '200':
          description: PA requests retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/PARequest'
                  total:
                    type: integer
                  limit:
                    type: integer
                  offset:
                    type: integer

  /pa-requests/{id}:
    get:
      tags:
        - PA Requests
      summary: Get PA request by ID
      description: Retrieve a specific PA request by its ID
      operationId: getPARequest
      parameters:
        - name: id
          in: path
          required: true
          description: PA request ID
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: PA request retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PARequest'
        '404':
          description: PA request not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    
    put:
      tags:
        - PA Requests
      summary: Update PA request
      description: Update an existing PA request
      operationId: updatePARequest
      parameters:
        - name: id
          in: path
          required: true
          description: PA request ID
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdatePARequestInput'
      responses:
        '200':
          description: PA request updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PARequest'
        '404':
          description: PA request not found

  /pa-requests/{id}/submit:
    post:
      tags:
        - PA Requests
      summary: Submit PA request
      description: Submit a PA request to the payer
      operationId: submitPARequest
      parameters:
        - name: id
          in: path
          required: true
          description: PA request ID
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: PA request submitted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SubmissionResult'
        '400':
          description: Invalid request or validation failed
        '404':
          description: PA request not found

  /pa-requests/{id}/status:
    get:
      tags:
        - PA Requests
      summary: Get PA request status
      description: Get the current status of a PA request
      operationId: getPARequestStatus
      parameters:
        - name: id
          in: path
          required: true
          description: PA request ID
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Status retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                    format: uuid
                  status:
                    $ref: '#/components/schemas/PAStatus'
                  updatedAt:
                    type: string
                    format: date-time

  /workflows:
    post:
      tags:
        - Workflows
      summary: Create workflow
      description: Create a new workflow definition
      operationId: createWorkflow
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/WorkflowDefinition'
      responses:
        '201':
          description: Workflow created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WorkflowDefinition'
    
    get:
      tags:
        - Workflows
      summary: List workflows
      description: Get all workflow definitions
      operationId: listWorkflows
      responses:
        '200':
          description: Workflows retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/WorkflowDefinition'

  /workflows/{id}:
    get:
      tags:
        - Workflows
      summary: Get workflow by ID
      description: Retrieve a specific workflow definition
      operationId: getWorkflow
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Workflow retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WorkflowDefinition'

  /config:
    get:
      tags:
        - Configuration
      summary: Get system configuration
      description: Retrieve system configuration (Admin only)
      operationId: getConfiguration
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Configuration retrieved successfully
          content:
            application/json:
              schema:
                type: object
                additionalProperties: true
        '403':
          description: Forbidden - Admin role required

  /config/{key}:
    put:
      tags:
        - Configuration
      summary: Update configuration
      description: Update a specific configuration value (Admin only)
      operationId: updateConfiguration
      parameters:
        - name: key
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                value:
                  type: object
      responses:
        '200':
          description: Configuration updated successfully
        '403':
          description: Forbidden - Admin role required

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT token for authentication

  schemas:
    PAStatus:
      type: string
      enum:
        - draft
        - pending-validation
        - validated
        - submitted
        - in-review
        - approved
        - denied
        - more-info-required
        - cancelled
        - error
      description: PA request lifecycle status

    Priority:
      type: string
      enum:
        - urgent
        - standard
      description: |
        Priority level:
        - urgent: 72 hour response required
        - standard: 7 day response required

    SubmissionMethod:
      type: string
      enum:
        - fhir
        - x12
      description: Electronic transmission format

    HealthResponse:
      type: object
      properties:
        status:
          type: string
          example: healthy
        timestamp:
          type: string
          format: date-time
        services:
          type: object
          properties:
            database:
              type: string
              example: up
            messageQueue:
              type: string
              example: up
            api:
              type: string
              example: up

    ErrorResponse:
      type: object
      properties:
        error:
          type: string
          example: Bad Request
        message:
          type: string
          example: Invalid request data
        details:
          type: array
          items:
            type: object
            properties:
              field:
                type: string
              message:
                type: string

    HumanName:
      type: object
      properties:
        use:
          type: string
          enum: [official, usual, nickname, maiden]
        family:
          type: string
        given:
          type: array
          items:
            type: string
        prefix:
          type: array
          items:
            type: string
        suffix:
          type: array
          items:
            type: string

    Address:
      type: object
      properties:
        use:
          type: string
          enum: [home, work, temp, billing]
        line:
          type: array
          items:
            type: string
        city:
          type: string
        state:
          type: string
        postalCode:
          type: string
        country:
          type: string

    ContactInfo:
      type: object
      properties:
        phone:
          type: string
        email:
          type: string
        fax:
          type: string

    PatientDemographics:
      type: object
      required:
        - name
        - birthDate
        - gender
        - address
      properties:
        name:
          $ref: '#/components/schemas/HumanName'
        birthDate:
          type: string
          format: date
          example: "1980-01-15"
        gender:
          type: string
          enum: [male, female, other, unknown]
        address:
          $ref: '#/components/schemas/Address'
        telecom:
          $ref: '#/components/schemas/ContactInfo'

    Patient:
      type: object
      required:
        - id
        - demographics
        - memberId
        - coverageInfo
      properties:
        id:
          type: string
        demographics:
          $ref: '#/components/schemas/PatientDemographics'
        memberId:
          type: string
        coverageInfo:
          type: array
          items:
            type: object
            properties:
              id:
                type: string
              status:
                type: string
                enum: [active, cancelled, draft, entered-in-error]
              payor:
                type: object
                properties:
                  id:
                    type: string
                  name:
                    type: string
                  identifier:
                    type: string

    Organization:
      type: object
      required:
        - id
        - name
        - address
        - active
      properties:
        id:
          type: string
        name:
          type: string
        type:
          type: string
        address:
          $ref: '#/components/schemas/Address'
        telecom:
          $ref: '#/components/schemas/ContactInfo'
        active:
          type: boolean

    Provider:
      type: object
      required:
        - npi
        - name
        - organization
        - contactInfo
      properties:
        npi:
          type: string
          pattern: '^[0-9]{10}$'
          description: National Provider Identifier
        name:
          $ref: '#/components/schemas/HumanName'
        organization:
          $ref: '#/components/schemas/Organization'
        contactInfo:
          $ref: '#/components/schemas/ContactInfo'
        specialty:
          type: string

    CodeableConcept:
      type: object
      properties:
        coding:
          type: array
          items:
            type: object
            properties:
              system:
                type: string
                format: uri
              code:
                type: string
              display:
                type: string
        text:
          type: string

    ServiceRequest:
      type: object
      required:
        - serviceType
      properties:
        serviceType:
          $ref: '#/components/schemas/CodeableConcept'
        diagnosis:
          type: array
          items:
            type: object
            properties:
              code:
                $ref: '#/components/schemas/CodeableConcept'
              onsetDate:
                type: string
                format: date
        procedure:
          type: array
          items:
            type: object
            properties:
              code:
                $ref: '#/components/schemas/CodeableConcept'
              performedDate:
                type: string
                format: date
        supportingDocumentation:
          type: array
          items:
            type: object
            properties:
              id:
                type: string
              type:
                type: string
              url:
                type: string
                format: uri

    SubmissionDetails:
      type: object
      properties:
        submittedAt:
          type: string
          format: date-time
        submissionMethod:
          $ref: '#/components/schemas/SubmissionMethod'
        payerEndpoint:
          type: string
          format: uri
        trackingId:
          type: string
          pattern: '^PA-[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$'

    PARequest:
      type: object
      required:
        - id
        - status
        - priority
        - patient
        - requestingProvider
        - serviceRequest
        - automationFlags
        - auditTrail
        - createdAt
        - updatedAt
      properties:
        id:
          type: string
          format: uuid
        status:
          $ref: '#/components/schemas/PAStatus'
        priority:
          $ref: '#/components/schemas/Priority'
        patient:
          $ref: '#/components/schemas/Patient'
        requestingProvider:
          $ref: '#/components/schemas/Provider'
        serviceRequest:
          $ref: '#/components/schemas/ServiceRequest'
        submissionDetails:
          $ref: '#/components/schemas/SubmissionDetails'
        automationFlags:
          type: object
          properties:
            autoPopulated:
              type: boolean
            autoSubmitEligible:
              type: boolean
            requiresManualReview:
              type: boolean
        auditTrail:
          type: array
          items:
            type: object
            properties:
              action:
                type: string
              timestamp:
                type: string
                format: date-time
              actorId:
                type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
        submittedAt:
          type: string
          format: date-time
        notes:
          type: string

    CreatePARequestInput:
      type: object
      required:
        - priority
        - patient
        - requestingProvider
        - serviceRequest
      properties:
        priority:
          $ref: '#/components/schemas/Priority'
        patient:
          $ref: '#/components/schemas/Patient'
        requestingProvider:
          $ref: '#/components/schemas/Provider'
        serviceRequest:
          $ref: '#/components/schemas/ServiceRequest'
        notes:
          type: string

    UpdatePARequestInput:
      type: object
      properties:
        status:
          $ref: '#/components/schemas/PAStatus'
        priority:
          $ref: '#/components/schemas/Priority'
        notes:
          type: string

    SubmissionResult:
      type: object
      properties:
        success:
          type: boolean
        trackingId:
          type: string
        submittedAt:
          type: string
          format: date-time
        payerResponse:
          type: object
          properties:
            status:
              type: string
            message:
              type: string
            referenceNumber:
              type: string

    WorkflowDefinition:
      type: object
      required:
        - id
        - name
        - enabled
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        description:
          type: string
        enabled:
          type: boolean
        rules:
          type: array
          items:
            type: object
            properties:
              condition:
                type: string
              action:
                type: string
